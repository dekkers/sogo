From: Jeroen Dekkers <jeroen@dekkers.ch>
Date: Thu, 15 Dec 2011 12:36:45 +0100
Subject: Fix disappearing subject lines

---
 ChangeLog                              |    5 +++++
 UI/WebServerResources/ContactsUI.js    |    3 ++-
 UI/WebServerResources/MailerUI.js      |    1 -
 UI/WebServerResources/UIxMailEditor.js |   16 ++++++++--------
 4 files changed, 15 insertions(+), 10 deletions(-)

diff --git a/ChangeLog b/ChangeLog
index 331a1bf..581da12 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,8 @@
+2011-12-14  Francis Lachapelle  <flachapelle@inverse.ca>
+
+	* UI/WebServerResources/ContactsUI.js (getMenus): register the
+	function onWindowResize only if it's not already defined.
+
 2011-12-12  Wolfgang Sourdeau  <wsourdeau@inverse.ca>
 
 	* SoObjects/Appointments/iCalEvent+SOGo.m (-quickRecord): set
diff --git a/UI/WebServerResources/ContactsUI.js b/UI/WebServerResources/ContactsUI.js
index bd3e5f6..e38f370 100644
--- a/UI/WebServerResources/ContactsUI.js
+++ b/UI/WebServerResources/ContactsUI.js
@@ -1322,6 +1322,7 @@ function initContacts(event) {
     if (typeof onWindowResize != 'function') {
         // When loaded from the mail editor, onWindowResize is
         // already registered
+        onWindowResize = onContactsWindowResize;
         onWindowResize.defer();
         Event.observe(window, "resize", onWindowResize);
     } 
@@ -1330,7 +1331,7 @@ function initContacts(event) {
     sorting["ascending"] = true;
 }
 
-function onWindowResize(event) {
+onContactsWindowResize = function (event) {
     var handle = $("dragHandle");
     if (handle)
         handle.adjust();
diff --git a/UI/WebServerResources/MailerUI.js b/UI/WebServerResources/MailerUI.js
index 76b20d5..de8d40d 100644
--- a/UI/WebServerResources/MailerUI.js
+++ b/UI/WebServerResources/MailerUI.js
@@ -1910,7 +1910,6 @@ function onMessageListResize(event) {
 }
 
 function onWindowResize(event) {
-    log ("resize mailer");
     var handle = $("verticalDragHandle");
     if (handle)
         handle.adjust();
diff --git a/UI/WebServerResources/UIxMailEditor.js b/UI/WebServerResources/UIxMailEditor.js
index 9c8fb79..ab9ebe0 100644
--- a/UI/WebServerResources/UIxMailEditor.js
+++ b/UI/WebServerResources/UIxMailEditor.js
@@ -25,7 +25,7 @@ function onContactAdd(button) {
     }
 
     $("hiddenDragHandle").adjust();
-    onMailEditorResize(null);
+    onWindowResize(null);
 }
 
 function addContact(tag, fullContactName, contactId, contactName, contactEmail) {
@@ -56,7 +56,7 @@ function addContact(tag, fullContactName, contactId, contactName, contactEmail)
             var select = $(td.childNodesWithTag("select")[0]);
             select.value = neededOptionValue;
             insertContact($("addr_" + currentIndex), contactName, contactEmail);
-            onMailEditorResize(null);
+            onWindowResize(null);
         }
     }
 }
@@ -212,7 +212,7 @@ function clickedEditorAttach() {
 
         if (!area.style.display) {
             area.setStyle({ display: "block" });
-            onMailEditorResize(null);
+            onWindowResize(null);
         }
         var inputs = area.getElementsByTagName("input");
         var attachmentName = "attachment" + attachmentCount;
@@ -368,7 +368,7 @@ function configureDragHandle() {
         handle.leftMargin = 100;
         handle.leftBlock=$("leftPanel");
         handle.rightBlock=$("rightPanel");
-        handle.observe("handle:dragged", onMailEditorResize);
+        handle.observe("handle:dragged", onWindowResize);
     }
 }
 
@@ -437,10 +437,10 @@ function initMailEditor() {
     $("contactFolder").observe("change", onContactFolderChange);
     
     
-    Event.observe(window, "resize", onMailEditorResize);
+    Event.observe(window, "resize", onWindowResize);
     Event.observe(window, "beforeunload", onMailEditorClose);
     
-    onMailEditorResize.defer();
+    onWindowResize.defer();
 }
 
 function focusCKEditor(event) {
@@ -584,7 +584,7 @@ function onSelectOptions(event) {
     }
 }
 
-function onMailEditorResize(event) {
+function onWindowResize(event) {
     if (!document.pageform)
       return;
     var textarea = document.pageform.text;
@@ -631,7 +631,7 @@ function onMailEditorResize(event) {
     if (composeMode == "html") {
         var editor = $('cke_text');
         if (editor == null) {
-            onMailEditorResize.defer();
+            onWindowResize.defer();
             return;
         }
         var ck_top = $("cke_top_text");
-- 
